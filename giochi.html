<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giochi e Quiz - Patristica</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-red: #d32f2f;
            --light-red-bg: #fff5f5;
            --contact-blue: #0d6efd;
            --card-back: #ef5350;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--light-red-bg);
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .page-header {
            background-color: white;
            border-bottom: 3px solid var(--primary-red);
            padding: 1.5rem 1rem;
            margin-bottom: 2rem;
        }

        h1, h2, h3 {
            font-family: 'Cinzel', serif;
            color: var(--primary-red);
        }

        /* Game Menu Cards */
        .game-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid transparent;
        }
        .game-card:hover {
            transform: scale(1.02);
            border-color: var(--primary-red);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* QUIZ Styles */
        .quiz-option {
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #ddd;
            background: white;
        }
        .quiz-option:hover {
            background-color: #f8f9fa;
            border-color: #aaa;
        }
        .quiz-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724;
        }
        .quiz-option.wrong {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24;
        }

        /* MEMORY Styles */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        .memory-card {
            background-color: white;
            height: 100px;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.8rem;
            padding: 5px;
            font-weight: bold;
            user-select: none;
        }
        .memory-card.flipped {
            background-color: white;
            color: #333;
            border: 2px solid var(--primary-red);
        }
        .memory-card.hidden-face {
            background-color: var(--card-back);
            color: transparent;
        }
        .memory-card.hidden-face::after {
            content: '?';
            color: white;
            font-size: 2rem;
            font-family: 'Cinzel', serif;
        }
        .memory-card.matched {
            background-color: #d4edda;
            border-color: #28a745;
            cursor: default;
        }

        /* Footer Styles */
        footer {
            margin-top: auto;
            background-color: white;
            border-top: 1px solid #dee2e6;
            padding: 15px 0;
            font-size: 0.85rem;
        }
        .contact-link {
            color: var(--contact-blue);
            text-decoration: none;
            margin: 0 10px;
            font-weight: 600;
        }
        .contact-link:hover { opacity: 0.7; text-decoration: underline; }
    </style>
</head>
<body>

    <header class="page-header d-flex justify-content-between align-items-center container-fluid px-4">
        <a href="index.html" class="btn btn-outline-danger btn-sm">
            <i class="bi bi-arrow-left"></i> Torna alla Home
        </a>
        <h2 class="m-0">Mettiti alla Prova</h2>
        <div style="width: 100px;"></div>
    </header>

    <main class="container my-4">

        <div id="gameMenu" class="row g-4 justify-content-center">
            <div class="col-md-5">
                <div class="card h-100 game-card text-center p-4" onclick="startQuiz()">
                    <div class="card-body">
                        <i class="bi bi-question-circle-fill text-danger display-1 mb-3"></i>
                        <h3>Il Quiz del Teologo</h3>
                        <p>10 domande a risposta multipla sui Padri, le date e le opere. L'ordine cambia sempre!</p>
                        <button class="btn btn-danger mt-2">Inizia Quiz</button>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="card h-100 game-card text-center p-4" onclick="startMemory()">
                    <div class="card-body">
                        <i class="bi bi-grid-3x3-gap-fill text-danger display-1 mb-3"></i>
                        <h3>Memory Patristico</h3>
                        <p>Trova le coppie! Abbina il nome del Padre al suo titolo o alla sua opera principale.</p>
                        <button class="btn btn-danger mt-2">Inizia Memory</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="quizContainer" style="display: none;" class="max-w-md mx-auto">
            <div class="card shadow">
                <div class="card-header bg-danger text-white d-flex justify-content-between">
                    <span id="questionCounter">Domanda 1/10</span>
                    <span id="scoreCounter">Punti: 0</span>
                </div>
                <div class="card-body text-center">
                    <h4 id="questionText" class="mb-4 mt-2">Testo della domanda...</h4>
                    <div id="optionsContainer" class="d-grid gap-2">
                        </div>
                </div>
                <div class="card-footer text-center">
                    <button class="btn btn-secondary btn-sm" onclick="showMenu()">Esci</button>
                    <button id="nextBtn" class="btn btn-primary btn-sm" style="display:none;" onclick="nextQuestion()">Prossima <i class="bi bi-arrow-right"></i></button>
                </div>
            </div>
        </div>

        <div id="quizResult" class="text-center" style="display: none;">
            <i class="bi bi-trophy-fill text-warning display-1"></i>
            <h2 class="mt-3">Quiz Completato!</h2>
            <p class="lead">Hai totalizzato <span id="finalScore" class="fw-bold text-danger"></span> su <span id="totalQuestions"></span></p>
            <button class="btn btn-outline-danger" onclick="showMenu()">Torna al Menu</button>
            <button class="btn btn-danger" onclick="startQuiz()">Riprova</button>
        </div>

        <div id="memoryContainer" style="display: none;">
            <div class="text-center mb-3">
                <h4>Trova le coppie (Padre - Titolo)</h4>
                <button class="btn btn-sm btn-outline-secondary" onclick="showMenu()">Esci dal gioco</button>
            </div>
            <div id="memoryGrid" class="memory-grid">
                </div>
            <div id="memoryWin" class="text-center mt-4" style="display: none;">
                <h3 class="text-success fw-bold">Hai vinto!</h3>
                <button class="btn btn-danger mt-2" onclick="startMemory()">Gioca ancora</button>
            </div>
        </div>

    </main>

    <footer>
        <div class="container text-center">
            <h6 class="text-uppercase text-muted mb-2" style="font-size: 0.7rem; letter-spacing: 1px;">Contatti</h6>
            <div class="d-flex justify-content-center align-items-center flex-wrap gap-3">
                <a href="https://www.instagram.com/lns_luca" target="_blank" class="contact-link">
                    <i class="bi bi-instagram"></i> lns_luca
                </a>
                <a href="https://www.tiktok.com/@lns_luca" target="_blank" class="contact-link">
                    <i class="bi bi-tiktok"></i> @lns_luca
                </a>
                <a href="mailto:lnsbusiness0@gmail.com" class="contact-link">
                    <i class="bi bi-envelope-fill"></i> lnsbusiness0@gmail.com
                </a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- DATABASE DATI ---
        const quizData = [
            { q: "Chi ha scritto la 'Vulgata'?", options: ["Agostino", "Girolamo", "Tertulliano", "Origene"], a: 1 },
            { q: "In che periodo visse Agostino d'Ippona?", options: ["I secolo", "VIII secolo", "IV-V secolo", "II secolo"], a: 2 },
            { q: "Chi è definito 'Dottore della Grazia'?", options: ["Agostino", "Ambrogio", "Cipriano", "Basilio"], a: 0 },
            { q: "Chi ha difeso la fede contro l'Arianesimo?", options: ["Atanasio", "Ignazio", "Tertulliano", "Giustino"], a: 0 },
            { q: "Quale Padre appartiene ai Cappadoci?", options: ["Leone Magno", "Basilio Magno", "Clemente Romano", "Ireneo"], a: 1 },
            { q: "Tertulliano è famoso per aver coniato il termine:", options: ["Trinità", "Consustanziale", "Theotokos", "Vulgata"], a: 0 },
            { q: "Giovanni Crisostomo significa:", options: ["Bocca d'Oro", "Mano di Dio", "Voce nel deserto", "Cuore Puro"], a: 0 },
            { q: "Chi ha scritto la regola 'Ora et Labora'?", options: ["Agostino", "Benedetto", "Girolamo", "Antonio"], a: 1 },
            { q: "L'ultimo Padre della Chiesa Greca è:", options: ["Giovanni Damasceno", "Massimo il Confessore", "Origene", "Cirillo"], a: 0 },
            { q: "Ambrogio era vescovo di:", options: ["Roma", "Milano", "Cartagine", "Alessandria"], a: 1 }
        ];

        const memoryPairs = [
            { txt: "Agostino", match: "Ippona" },
            { txt: "Ambrogio", match: "Milano" },
            { txt: "Girolamo", match: "Bibbia" },
            { txt: "Atanasio", match: "Anti-Ario" },
            { txt: "Benedetto", match: "Regola" },
            { txt: "Origene", match: "Esegesi" },
            { txt: "Tertulliano", match: "Latino" },
            { txt: "Leone Magno", match: "Papa" }
        ];

        // --- VARIABILI DI STATO ---
        let currentQuestions = [];
        let currentQuestionIdx = 0;
        let score = 0;
        
        let memoryCards = [];
        let flippedCards = [];
        let matchedCount = 0;
        let lockBoard = false;

        // --- UTILITY: Shuffle Array (Mescola) ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- GESTIONE VISTE ---
        function showMenu() {
            document.getElementById('gameMenu').style.display = 'flex';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('quizResult').style.display = 'none';
            document.getElementById('memoryContainer').style.display = 'none';
        }

        // --- LOGICA QUIZ ---
        function startQuiz() {
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('quizResult').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            
            // Mescola le domande ogni volta
            currentQuestions = shuffle([...quizData]); 
            currentQuestionIdx = 0;
            score = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const qData = currentQuestions[currentQuestionIdx];
            document.getElementById('questionCounter').innerText = `Domanda ${currentQuestionIdx + 1}/${currentQuestions.length}`;
            document.getElementById('scoreCounter').innerText = `Punti: ${score}`;
            document.getElementById('questionText').innerText = qData.q;
            document.getElementById('nextBtn').style.display = 'none';

            const optsDiv = document.getElementById('optionsContainer');
            optsDiv.innerHTML = '';

            // Creiamo copie delle opzioni per poterle mescolare se volessimo, 
            // ma qui mescoliamo solo l'ordine delle domande. 
            // Manteniamo l'ordine opzioni fisso o statico per semplicità logica, 
            // ma l'indice della risposta corretta (a) si riferisce all'array originale.
            // Per semplicità nel codice scolastico, non mescolo le opzioni singole, solo le domande.
            
            qData.options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'card p-3 mb-2 quiz-option';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, idx, qData.a);
                optsDiv.appendChild(btn);
            });
        }

        function checkAnswer(btn, selectedIdx, correctIdx) {
            // Disabilita tutti i click
            const allOpts = document.querySelectorAll('.quiz-option');
            allOpts.forEach(o => o.onclick = null);

            if (selectedIdx === correctIdx) {
                btn.classList.add('correct');
                score++;
                document.getElementById('scoreCounter').innerText = `Punti: ${score}`;
            } else {
                btn.classList.add('wrong');
                // Evidenzia quella giusta
                allOpts[correctIdx].classList.add('correct');
            }

            // Mostra bottone prossima
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.style.display = 'inline-block';
            
            if (currentQuestionIdx === currentQuestions.length - 1) {
                nextBtn.innerText = "Vedi Risultati";
                nextBtn.onclick = endQuiz;
            } else {
                nextBtn.innerText = "Prossima";
                nextBtn.onclick = nextQuestion;
            }
        }

        function nextQuestion() {
            currentQuestionIdx++;
            loadQuestion();
        }

        function endQuiz() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('quizResult').style.display = 'block';
            document.getElementById('finalScore').innerText = score;
            document.getElementById('totalQuestions').innerText = currentQuestions.length;
        }

        // --- LOGICA MEMORY ---
        function startMemory() {
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('memoryContainer').style.display = 'block';
            document.getElementById('memoryWin').style.display = 'none';
            
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            flippedCards = [];
            matchedCount = 0;
            lockBoard = false;

            // Prepara mazzo: Coppie (A e B)
            let deck = [];
            memoryPairs.forEach(pair => {
                deck.push({ val: pair.txt, id: pair.txt + pair.match, type: 'A' }); // Es: Agostino
                deck.push({ val: pair.match, id: pair.txt + pair.match, type: 'B' }); // Es: Ippona
            });

            // Mescola mazzo
            deck = shuffle(deck);

            // Genera HTML
            deck.forEach(item => {
                const card = document.createElement('div');
                card.className = 'memory-card hidden-face';
                card.dataset.id = item.id; // ID condiviso dalla coppia
                card.innerText = item.val;
                
                card.addEventListener('click', function() {
                    flipCard(card);
                });

                grid.appendChild(card);
            });
        }

        function flipCard(card) {
            if (lockBoard) return;
            if (card === flippedCards[0]) return; // Non cliccare la stessa
            if (card.classList.contains('matched')) return;

            // Mostra faccia
            card.classList.remove('hidden-face');
            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                checkForMatch();
            }
        }

        function checkForMatch() {
            lockBoard = true;
            const c1 = flippedCards[0];
            const c2 = flippedCards[1];

            // Se hanno lo stesso dataset.id, sono una coppia
            if (c1.dataset.id === c2.dataset.id) {
                disableCards();
            } else {
                unflipCards();
            }
        }

        function disableCards() {
            flippedCards[0].classList.add('matched');
            flippedCards[1].classList.add('matched');
            flippedCards = [];
            matchedCount++;
            lockBoard = false;

            if (matchedCount === memoryPairs.length) {
                document.getElementById('memoryWin').style.display = 'block';
            }
        }

        function unflipCards() {
            setTimeout(() => {
                flippedCards[0].classList.add('hidden-face');
                flippedCards[0].classList.remove('flipped');
                flippedCards[1].classList.add('hidden-face');
                flippedCards[1].classList.remove('flipped');
                flippedCards = [];
                lockBoard = false;
            }, 1000);
        }

    </script>
</body>
</html>